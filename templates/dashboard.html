{{ define "content" }}
<div class="dashboard">
    <!-- Header Section -->
    <header class="dashboard-header">
        <div class="header-content">
            <h1 class="header-title">
                <svg class="logo-icon" viewBox="0 0 24 24">
                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                </svg>
                Notes Dashboard
            </h1>
        </div>

        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value">{{ .TotalNotes }}</div>
                <div class="stat-label">Total Notes</div>
                <div class="stat-icon">
                    <svg viewBox="0 0 24 24">
                        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/>
                    </svg>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ .PinnedCount }}</div>
                <div class="stat-label">Pinned</div>
                <div class="stat-icon">
                    <svg viewBox="0 0 24 24">
                        <path d="M18 1l-6 4-6-4-6 5v7l12 10 12-10v-7z"/>
                    </svg>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ .StarredCount }}</div>
                <div class="stat-label">Starred</div>
                <div class="stat-icon">
                    <svg viewBox="0 0 24 24">
                        <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                    </svg>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <div class="dashboard-main">
        <!-- Filters Panel -->
        <aside class="filters-panel">
            <div class="search-box">
                <form method="get" action="/dashboard" id="search-form">
                    <input type="text" name="search" placeholder="Search notes..." value="{{ .Search }}">
                    <button type="submit">
                        <svg viewBox="0 0 24 24">
                            <path d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 0 0 1.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 0 0-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 0 0 5.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                        </svg>
                    </button>
                    <input type="hidden" name="page" value="1">
                </form>
            </div>

            <div class="filter-section">
                <h3>Quick Filters</h3>
                <div class="filter-buttons">
                    <a href="{{ if .FilterPinned }}{{ removeQueryParam "filter_pinned" }}{{ else }}{{ addQueryParam "filter_pinned" "true" }}{{ end }}"
                    class="filter-btn {{ if .FilterPinned }}active{{ end }}">
                    <svg viewBox="0 0 24 24">
                        <path d="M18 1l-6 4-6-4-6 5v7l12 10 12-10v-7z"/>
                    </svg>
                    Pinned
                    </a>
                    <a href="{{ if .FilterStarred }}{{ removeQueryParam "filter_starred" }}{{ else }}{{ addQueryParam "filter_starred" "true" }}{{ end }}"
                    class="filter-btn {{ if .FilterStarred }}active{{ end }}">
                    <svg viewBox="0 0 24 24">
                        <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                    </svg>
                    Starred
                    </a>
                </div>
            </div>

            <div class="filter-section">
                <h3>Sort By</h3>
                <form method="get" action="/dashboard" class="sort-form">
                    {{ if .Search }}<input type="hidden" name="search" value="{{ .Search }}">{{ end }}
                    {{ if .FilterPinned }}<input type="hidden" name="filter_pinned" value="true">{{ end }}
                    {{ if .FilterStarred }}<input type="hidden" name="filter_starred" value="true">{{ end }}
                    {{ range .SelectedTags }}<input type="hidden" name="tag" value="{{ . }}">{{ end }}
                    <input type="hidden" name="page" value="1">
                    <select name="sort_by" onchange="this.form.submit()">
                        <option value="created_at_desc" {{ if eq .SortBy "created_at_desc" }}selected{{ end }}>Newest First</option>
                        <option value="created_at_asc" {{ if eq .SortBy "created_at_asc" }}selected{{ end }}>Oldest First</option>
                        <option value="title_asc" {{ if eq .SortBy "title_asc" }}selected{{ end }}>Title (A-Z)</option>
                        <option value="title_desc" {{ if eq .SortBy "title_desc" }}selected{{ end }}>Title (Z-A)</option>
                    </select>
                </form>
            </div>

            <div class="filter-section">
                <div class="tags-header">
                    <h3>Tags</h3>
                    {{ if .SelectedTags }}
                    <a href="" class="clear-tags">Clear</a>
                    {{ end }}
                </div>
                <div class="tags-container">
                    {{ if .TagCloud }}
                    {{ range $tag, $count := .TagCloud }}
                    <a href="{{ toggleTag $tag }}" class="tag {{ if containsTag $tag }}active{{ end }}">
                        {{ $tag }} <span class="tag-count">{{ $count }}</span>
                    </a>
                    {{ end }}
                    {{ else }}
                    <p class="no-tags">No tags available</p>
                    {{ end }}
                </div>
            </div>
        </aside>

        <!-- Notes Grid -->
        <main class="notes-container">
            <div class="notes-header">
                <h2>
                    {{ if .FilterPinned }}Pinned Notes
                    {{ else if .FilterStarred }}Starred Notes
                    {{ else if .Search }}Search Results
                    {{ else }}All Notes{{ end }}
                    {{ if .SelectedTags }}
                    <span class="filtered-by">filtered by:</span>
                    {{ range .SelectedTags }}<span class="active-tag">{{ . }}</span>{{ end }}
                    {{ end }}
                </h2>
                <div class="notes-count">{{ len .Notes }} notes</div>
            </div>

            {{ if .Notes }}
            <div class="notes-grid">
                {{ range .Notes }}
                <article class="note-card {{ if .IsPinned }}pinned{{ end }} {{ if .IsStarred }}starred{{ end }}">
                    <div class="note-header">
                        <h3 class="note-title">{{ .Title }}</h3>
                        <div class="note-badges">
                            {{ if .IsPinned }}
                            <span class="badge pinned">
                                <svg viewBox="0 0 24 24">
                                    <path d="M18 1l-6 4-6-4-6 5v7l12 10 12-10v-7z"/>
                                </svg>
                            </span>
                            {{ end }}
                            {{ if .IsStarred }}
                            <span class="badge starred">
                                <svg viewBox="0 0 24 24">
                                    <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                                </svg>
                            </span>
                            {{ end }}
                        </div>
                    </div>

                    <div class="note-content">
                        {{ .Content | safeHTML }}
                    </div>

                    <div class="note-footer">
                        <div class="note-tags">
                            {{ if .Tags }}
                            {{ range split .Tags "," }}
                            <span class="tag">{{ . }}</span>
                            {{ end }}
                            {{ end }}
                        </div>
                        <div class="note-actions">
                            <a href="/notes/view/{{ .ID }}" class="action-btn view" title="View note">
                                <svg viewBox="0 0 24 24">
                                    <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                                </svg>
                            </a>
                            <button class="action-btn download" data-title="{{ .Title }}" data-content="{{ .Content | safeHTML }}" title="Download note">
                                <svg viewBox="0 0 24 24">
                                    <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="note-meta">
                        <time datetime="{{ .CreatedAt.Format "2006-01-02T15:04:05Z07:00" }}">{{ .CreatedAt.Format "Jan 2, 2006 at 3:04 PM" }}</time>
                    </div>
                </article>
                {{ end }}
            </div>

            <!-- Pagination -->
            <div class="pagination">
                {{ if gt .Page 1 }}
                <a href="{{ addPageParam (sub .Page 1) }}" class="page-btn">
                    <svg viewBox="0 0 24 24">
                        <path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"/>
                    </svg>
                    Previous
                </a>
                {{ end }}

                <div class="page-numbers">
                    {{ if .Notes }}
                        {{ if gt .Page 1 }}
                        <a href="{{ addPageParam (sub .Page 1) }}" class="page-link">Previous</a>
                        {{ end }}

                        <span class="page-info">Page {{ .Page }} of {{ .TotalPages }}</span>

                        {{ if lt .Page .TotalPages }}
                        <a href="{{ addPageParam (add .Page 1) }}" class="page-link">Next</a>
                        {{ end }}
                    {{ end }}
                </div>

                {{ if lt .Page .TotalPages }}
                <a href="{{ addPageParam (add .Page 1) }}" class="page-btn">
                    Next
                    <svg viewBox="0 0 24 24">
                        <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
                    </svg>
                </a>
                {{ end }}
            </div>
            {{ else }}
            <div class="empty-state">
                <div class="empty-illustration">
                    <svg viewBox="0 0 200 200">
                        <path fill="#E5E7EB" d="M100 0C44.8 0 0 44.8 0 100s44.8 100 100 100 100-44.8 100-100S155.2 0 100 0zm0 180c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"/>
                        <path fill="#E5E7EB" d="M140 70H60v60h80V70zm-10 50H70V80h60v40z"/>
                        <path fill="#E5E7EB" d="M85 85h30v30H85z"/>
                    </svg>
                </div>
                <h3>No notes found</h3>
                <p>Try adjusting your filters or create a new note</p>
                <a href="/notes/new" class="create-btn">
                    <svg viewBox="0 0 24 24">
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                    </svg>
                    Create Note
                </a>
            </div>
            {{ end }}
        </main>
    </div>
</div>

<style>
    /* Color Variables */
    :root {
        --primary: #4f46e5;
        --primary-light: #6366f1;
        --primary-dark: #4338ca;
        --secondary: #10b981;
        --danger: #ef4444;
        --warning: #f59e0b;
        --info: #3b82f6;
        --light: #f9fafb;
        --dark: #111827;
        --gray-100: #f3f4f6;
        --gray-200: #e5e7eb;
        --gray-300: #d1d5db;
        --gray-400: #9ca3af;
        --gray-500: #6b7280;
        --gray-600: #4b5563;
        --gray-700: #374151;
        --gray-800: #1f2937;
        --gray-900: #111827;
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.3), 0 1px 2px 0 rgba(0, 0, 0, 0.03);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.08);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.07);
        --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.06);
        --radius-sm: 0.125rem;
        --radius: 0.25rem;
        --radius-md: 0.375rem;
        --radius-lg: 1rem;
        --radius-xl: 0.75rem;
        --radius-2xl: 1rem;
        --radius-full: 9999px;
    }

    /* Base Styles */
    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        line-height: 1.5;
        color: var(--gray-900);
        background-color: var(--gray-100);
    }

    a {
        text-decoration: none;
        color: inherit;
    }

    button {
        background: none;
        border: none;
        cursor: pointer;
    }

    svg {
        fill: currentColor;
    }

    /* Dashboard Layout */
    .dashboard {
        max-width: 1600px;
        margin: 0 auto;
        padding: 1.5rem;
    }

    /* Header Styles */
    .dashboard-header {
        margin-bottom: 2rem;
    }

    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
    }

    .header-title {
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--gray-900);
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .logo-icon {
        width: 28px;
        height: 28px;
        fill: var(--primary);
    }

    .new-note-btn {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.625rem 1rem;
        background: var(--primary);
        color: white;
        border-radius: var(--radius-md);
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.2s ease;
    }

    .new-note-btn:hover {
        background: var(--primary-dark);
        transform: translateY(-1px);
        box-shadow: var(--shadow);
    }

    .new-note-btn svg {
        width: 16px;
        height: 16px;
    }

    /* Stats Grid */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 1rem;
    }

    .stat-card {
        background: white;
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        box-shadow: var(--shadow);
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
    }

    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
    }

    .stat-value {
        font-size: 2rem;
        font-weight: 700;
        color: var(--gray-900);
        margin-bottom: 0.25rem;
    }

    .stat-label {
        font-size: 0.875rem;
        color: var(--gray-500);
    }

    .stat-icon {
        position: absolute;
        right: 1.5rem;
        top: 1.5rem;
        width: 48px;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--gray-100);
        border-radius: var(--radius-full);
        color: var(--primary);
    }

    .stat-icon svg {
        width: 24px;
        height: 24px;
    }

    /* Main Content */
    .dashboard-main {
        display: grid;
        grid-template-columns: 280px 1fr;
        gap: 1.5rem;
    }

    @media (max-width: 1024px) {
        .dashboard-main {
            grid-template-columns: 1fr;
        }
    }

    /* Filters Panel */
    .filters-panel {
        background: white;
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        box-shadow: var(--shadow);
        height: fit-content;
        position: sticky;
        top: 1rem;
    }

    .search-box {
        margin-bottom: 1.5rem;
    }

    .search-box form {
        position: relative;
    }

    .search-box input[type="text"] {
        width: 100%;
        padding: 0.75rem 1rem 0.75rem 2.5rem;
        border: 1px solid var(--gray-200);
        border-radius: var(--radius-md);
        font-size: 0.875rem;
        transition: all 0.2s ease;
        background-color: var(--gray-100);
    }

    .search-box input[type="text"]:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        background-color: white;
    }

    .search-box button {
        position: absolute;
        left: 0.75rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--gray-400);
    }

    .search-box button svg {
        width: 18px;
        height: 18px;
    }

    .filter-section {
        margin-bottom: 1.5rem;
        padding-bottom: 1.5rem;
        border-bottom: 1px solid var(--gray-200);
    }

    .filter-section:last-child {
        margin-bottom: 0;
        padding-bottom: 0;
        border-bottom: none;
    }

    .filter-section h3 {
        font-size: 0.9375rem;
        font-weight: 600;
        color: var(--gray-800);
        margin-bottom: 1rem;
    }

    .filter-buttons {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .filter-btn {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1rem;
        background: var(--gray-100);
        border-radius: var(--radius-md);
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--gray-700);
        transition: all 0.2s ease;
    }

    .filter-btn:hover {
        background: var(--gray-200);
    }

    .filter-btn.active {
        background: var(--primary);
        color: white;
    }

    .filter-btn.active svg {
        fill: white;
    }

    .filter-btn svg {
        width: 16px;
        height: 16px;
        fill: var(--gray-500);
    }

    .sort-form select {
        width: 100%;
        padding: 0.75rem 1rem;
        border: 1px solid var(--gray-200);
        border-radius: var(--radius-md);
        font-size: 0.875rem;
        background-color: var(--gray-100);
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%236b7280'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 0.75rem center;
        background-size: 1rem;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .sort-form select:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        background-color: white;
    }

    .tags-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
    }

    .clear-tags {
        font-size: 0.8125rem;
        color: var(--primary);
        font-weight: 500;
    }

    .clear-tags:hover {
        text-decoration: underline;
    }

    .tags-container {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
    }

    .tag {
        display: inline-flex;
        align-items: center;
        padding: 0.5rem 0.875rem;
        background: var(--gray-100);
        border-radius: var(--radius-full);
        font-size: 0.8125rem;
        color: var(--gray-700);
        transition: all 0.2s ease;
        border: 1px solid var(--gray-200);
    }

    .tag:hover {
        background: var(--gray-200);
    }

    .tag.active {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
    }

    .tag-count {
        margin-left: 0.25rem;
        font-size: 0.75rem;
        opacity: 0.8;
    }

    .no-tags {
        font-size: 0.875rem;
        color: var(--gray-500);
    }

    /* Notes Container */
    .notes-container {
        background: white;
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        box-shadow: var(--shadow);
    }

    .notes-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
    }

    .notes-header h2 {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--gray-900);
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        gap: 0.5rem;
    }

    .filtered-by {
        color: var(--gray-500);
        font-weight: 400;
    }

    .active-tag {
        display: inline-flex;
        align-items: center;
        padding: 0.25rem 0.75rem;
        background: var(--primary-light);
        color: white;
        border-radius: var(--radius-full);
        font-size: 0.8125rem;
        font-weight: 500;
    }

    .notes-count {
        font-size: 0.875rem;
        color: var(--gray-500);
        background: var(--gray-100);
        padding: 0.5rem 1rem;
        border-radius: var(--radius-full);
    }

    /* Notes Grid */
    .notes-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1.5rem;
    }

    /* Note Card */
    .note-card {
        background: white;
        border: 1px solid var(--gray-200);
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
        box-shadow: var(--shadow);
    }

    .note-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-lg);
    }

    .note-card.pinned {
        border-left: 0px solid var(--primary);
    }

    .note-card.starred {
        border-right: 0px solid var(--warning);
    }

    .note-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 1rem;
    }

    .note-title {
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--gray-900);
        margin: 0;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .note-badges {
        display: flex;
        gap: 0.5rem;
    }

    .badge {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 24px;
        height: 24px;
        border-radius: var(--radius-full);
        padding: 0.25rem;
    }

    .badge svg {
        width: 14px;
        height: 14px;
    }

    .pinned {
        background: rgba(79, 70, 229, 0.09);
        color: var(--primary);
    }

    .starred {
        background: rgba(245, 158, 11, 0.09);
        color: var(--warning);
    }

    .note-content {
        color: var(--gray-700);
        font-size: 0.9375rem;
        line-height: 1.6;
        margin-bottom: 1.5rem;
        display: -webkit-box;
        -webkit-line-clamp: 5;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .note-footer {
        margin-top: auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .note-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
    }

    .note-tags .tag {
        padding: 0.25rem 0.75rem;
        font-size: 0.75rem;
    }

    .note-actions {
        display: flex;
        gap: 0.5rem;
    }

    .action-btn {
        width: 32px;
        height: 32px;
        border-radius: var(--radius-md);
        border: 0.5px solid black;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--light);
        color: var(--dark);
        transition: all 0.2s ease;
    }

    .action-btn:hover {
        background: var(--primary);
        color: white;
    }

    .action-btn svg {
        width: 16px;
        height: 16px;
    }

    .note-meta {
        margin-top: 1rem;
    }

    .note-meta time {
        font-size: 0.75rem;
        color: var(--gray-500);
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 3rem 2rem;
    }

    .empty-illustration {
        width: 160px;
        height: 160px;
        margin: 0 auto 1.5rem;
        opacity: 0.5;
    }

    .empty-state h3 {
        font-size: 1.25rem;
        color: var(--gray-900);
        margin-bottom: 0.5rem;
    }

    .empty-state p {
        color: var(--gray-500);
        margin-bottom: 1.5rem;
    }

    .create-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1.5rem;
        background: var(--primary);
        color: white;
        border-radius: var(--radius-md);
        font-weight: 500;
        transition: all 0.2s ease;
    }

    .create-btn:hover {
        background: var(--primary-dark);
        transform: translateY(-1px);
        box-shadow: var(--shadow);
    }

    .create-btn svg {
        width: 16px;
        height: 16px;
    }

    /* Pagination */
    .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 1rem;
        margin-top: 3rem;
    }

    .page-btn {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.625rem 1.25rem;
        background: white;
        border: 1px solid var(--gray-200);
        border-radius: var(--radius-md);
        color: var(--gray-700);
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.2s ease;
    }

    .page-btn:hover {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
    }

    .page-btn svg {
        width: 16px;
        height: 16px;
    }

    .page-numbers {
        display: flex;
        gap: 0.5rem;
    }

    .page-number {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: var(--radius-md);
        font-size: 0.875rem;
        color: var(--gray-700);
        transition: all 0.2s ease;
    }

    .page-number:hover {
        background: var(--gray-100);
    }

    .page-number.active {
        background: var(--primary);
        color: white;
    }

    .page-ellipsis {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        color: var(--gray-500);
    }

    /* Responsive Adjustments */
    @media (max-width: 768px) {
        .dashboard {
            padding: 1rem;
        }

        .header-content {
            flex-direction: column;
            align-items: flex-start;
            gap: 1rem;
        }

        .stats-grid {
            grid-template-columns: 1fr;
        }

        .notes-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 1rem;
        }

        .notes-grid {
            grid-template-columns: 1fr;
        }

        .pagination {
            flex-direction: column;
            gap: 0.5rem;
        }

        .page-numbers {
            order: -1;
            margin-bottom: 0.5rem;
        }
    }

    /* Animation */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .note-card {
        animation: fadeIn 0.3s ease-out forwards;
    }

    /* Tag coloring */
    .note-tags .tag {
        background: #f3f4f6;
        color: var(--dark);
        border: 1px solid #e5e7eb;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Function to convert HTML to formatted text
        function htmlToFormattedText(html) {
            const temp = document.createElement('div');
            temp.innerHTML = html;

            temp.querySelectorAll('strong, b').forEach(el => {
                el.replaceWith(`*${el.textContent}*`);
            });

            temp.querySelectorAll('em, i').forEach(el => {
                el.replaceWith(`_${el.textContent}_`);
            });

            temp.querySelectorAll('h1, h2, h3, h4, h5, h6').forEach(el => {
                const text = el.textContent.toUpperCase();
                const underline = '='.repeat(text.length);
                el.replaceWith(`\n\n${text}\n${underline}\n\n`);
            });

            temp.querySelectorAll('ul').forEach(ul => {
                let bullets = '';
                ul.querySelectorAll('li').forEach(li => {
                    bullets += `• ${li.textContent}\n`;
                });
                ul.replaceWith(`\n${bullets}\n`);
            });

            temp.querySelectorAll('ol').forEach(ol => {
                let numbers = '';
                ol.querySelectorAll('li').forEach((li, i) => {
                    numbers += `${i+1}. ${li.textContent}\n`;
                });
                ol.replaceWith(`\n${numbers}\n`);
            });

            temp.querySelectorAll('hr').forEach(hr => {
                hr.replaceWith('\n' + '-'.repeat(50) + '\n');
            });

            temp.innerHTML = temp.innerHTML.replace(/<br\s*\/?>/gi, '\n');

            let text = temp.textContent;
            text = text.replace(/\n{3,}/g, '\n\n');
            return text.trim();
        }

        // Set up download buttons
        document.querySelectorAll('.download').forEach(button => {
            button.addEventListener('click', function() {
                const title = this.getAttribute('data-title');
                const htmlContent = this.getAttribute('data-content');
                const card = this.closest('.note-card');

                const noteTitle = card.querySelector('.note-title')?.textContent || 'Untitled Note';
                const noteContent = htmlToFormattedText(htmlContent);
                const noteTags = Array.from(card.querySelectorAll('.tag')).map(tag => tag.textContent).join(', ');
                const noteDate = card.querySelector('time')?.textContent || '';
                const isPinned = card.classList.contains('pinned') ? '📌 ' : '';
                const isStarred = card.classList.contains('starred') ? '⭐ ' : '';

                const textContent = `
${'='.repeat(noteTitle.length + 4)}
  ${isPinned}${isStarred}${noteTitle.toUpperCase()}
${'='.repeat(noteTitle.length + 4)}

${noteContent}

${'-'.repeat(40)}
TAGS: ${noteTags || 'None'}
DATE: ${noteDate}
`.trim();

                const blob = new Blob([textContent], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;

                const cleanTitle = title.replace(/[^\w\s-]/g, '');
                a.download = (cleanTitle || 'note') + '.txt';

                document.body.appendChild(a);
                a.click();

                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
            });
        });

        // Tag coloring for note tags
        const colors = ['#4f46e5', '#10b981', '#ef4444', '#f59e0b', '#8b5cf6', '#ec4899', '#14b8a6', '#f97316'];
        document.querySelectorAll('.note-tags .tag').forEach(tag => {
            const text = tag.textContent.toLowerCase();
            let hash = 0;
            for (let i = 0; i < text.length; i++) {
                hash = text.charCodeAt(i) + ((hash << 5) - hash);
            }
            const colorIndex = Math.abs(hash) % colors.length;
            tag.style.backgroundColor = `${colors[colorIndex]}15`;
            tag.style.color = colors[colorIndex];
            tag.style.border = `1px solid ${colors[colorIndex]}30`;
        });
    });

    document.addEventListener('DOMContentLoaded', function() {
        const urlParams = new URLSearchParams(window.location.search);

        // Check if this is the initial load (no query parameters)
        if (urlParams.toString() === '' && !sessionStorage.getItem('filtersModified')) {
            // Redirect to pinned view by default
            window.location.href = window.location.pathname + '?filter_pinned=true';
        }

        // When any filter link is clicked, set a flag
        document.querySelectorAll('[data-filter], .tag, .sort-form select').forEach(element => {
            element.addEventListener('click', function() {
                sessionStorage.setItem('filtersModified', 'true');
            });
        });
    });
</script>
{{ end }}